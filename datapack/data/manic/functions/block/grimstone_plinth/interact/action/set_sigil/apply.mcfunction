scoreboard players reset #error_type manic.dummy

# Enchantments
execute if data storage manic:storage root.temp.item.tag.manic{enchantment:"minecraft:efficiency"} if data entity @s item.tag.manic.item.tag.Enchantments[{id:"minecraft:efficiency"}] store result entity @s item.tag.manic.item.tag.Enchantments[{id:"minecraft:efficiency"}].lvl short -1 run data get entity @s item.tag.manic.item.tag.Enchantments[{id:"minecraft:efficiency"}].lvl -1.0000000001
execute if data storage manic:storage root.temp.item.tag.manic{enchantment:"minecraft:efficiency"} unless data entity @s item.tag.manic.item.tag.Enchantments[{id:"minecraft:efficiency"}] run data modify entity @s item.tag.manic.item.tag.Enchantments append value {id:"minecraft:efficiency",lvl:1s}
execute if data storage manic:storage root.temp.item.tag.manic{enchantment:"minecraft:fire_aspect"} if data entity @s item.tag.manic.item.tag.Enchantments[{id:"minecraft:fire_aspect"}] store result entity @s item.tag.manic.item.tag.Enchantments[{id:"minecraft:fire_aspect"}].lvl short -1 run data get entity @s item.tag.manic.item.tag.Enchantments[{id:"minecraft:fire_aspect"}].lvl -1.0000000001
execute if data storage manic:storage root.temp.item.tag.manic{enchantment:"minecraft:fire_aspect"} unless data entity @s item.tag.manic.item.tag.Enchantments[{id:"minecraft:fire_aspect"}] run data modify entity @s item.tag.manic.item.tag.Enchantments append value {id:"minecraft:fire_aspect",lvl:1s}
execute if data storage manic:storage root.temp.item.tag.manic{enchantment:"minecraft:fortune"} if data entity @s item.tag.manic.item.tag.Enchantments[{id:"minecraft:fortune"}] store result entity @s item.tag.manic.item.tag.Enchantments[{id:"minecraft:fortune"}].lvl short -1 run data get entity @s item.tag.manic.item.tag.Enchantments[{id:"minecraft:fortune"}].lvl -1.0000000001
execute if data storage manic:storage root.temp.item.tag.manic{enchantment:"minecraft:fortune"} unless data entity @s item.tag.manic.item.tag.Enchantments[{id:"minecraft:fortune"}] run data modify entity @s item.tag.manic.item.tag.Enchantments append value {id:"minecraft:fortune",lvl:1s}
execute if data storage manic:storage root.temp.item.tag.manic{enchantment:"minecraft:knockback"} if data entity @s item.tag.manic.item.tag.Enchantments[{id:"minecraft:knockback"}] store result entity @s item.tag.manic.item.tag.Enchantments[{id:"minecraft:knockback"}].lvl short -1 run data get entity @s item.tag.manic.item.tag.Enchantments[{id:"minecraft:knockback"}].lvl -1.0000000001
execute if data storage manic:storage root.temp.item.tag.manic{enchantment:"minecraft:knockback"} unless data entity @s item.tag.manic.item.tag.Enchantments[{id:"minecraft:knockback"}] run data modify entity @s item.tag.manic.item.tag.Enchantments append value {id:"minecraft:knockback",lvl:1s}
execute if data storage manic:storage root.temp.item.tag.manic{enchantment:"minecraft:looting"} if data entity @s item.tag.manic.item.tag.Enchantments[{id:"minecraft:looting"}] store result entity @s item.tag.manic.item.tag.Enchantments[{id:"minecraft:looting"}].lvl short -1 run data get entity @s item.tag.manic.item.tag.Enchantments[{id:"minecraft:looting"}].lvl -1.0000000001
execute if data storage manic:storage root.temp.item.tag.manic{enchantment:"minecraft:looting"} unless data entity @s item.tag.manic.item.tag.Enchantments[{id:"minecraft:looting"}] run data modify entity @s item.tag.manic.item.tag.Enchantments append value {id:"minecraft:looting",lvl:1s}
execute if data storage manic:storage root.temp.item.tag.manic{enchantment:"minecraft:power"} if data entity @s item.tag.manic.item.tag.Enchantments[{id:"minecraft:power"}] store result entity @s item.tag.manic.item.tag.Enchantments[{id:"minecraft:power"}].lvl short -1 run data get entity @s item.tag.manic.item.tag.Enchantments[{id:"minecraft:power"}].lvl -1.0000000001
execute if data storage manic:storage root.temp.item.tag.manic{enchantment:"minecraft:power"} unless data entity @s item.tag.manic.item.tag.Enchantments[{id:"minecraft:power"}] run data modify entity @s item.tag.manic.item.tag.Enchantments append value {id:"minecraft:power",lvl:1s}
execute if data storage manic:storage root.temp.item.tag.manic{enchantment:"minecraft:punch"} if data entity @s item.tag.manic.item.tag.Enchantments[{id:"minecraft:punch"}] store result entity @s item.tag.manic.item.tag.Enchantments[{id:"minecraft:punch"}].lvl short -1 run data get entity @s item.tag.manic.item.tag.Enchantments[{id:"minecraft:punch"}].lvl -1.0000000001
execute if data storage manic:storage root.temp.item.tag.manic{enchantment:"minecraft:punch"} unless data entity @s item.tag.manic.item.tag.Enchantments[{id:"minecraft:punch"}] run data modify entity @s item.tag.manic.item.tag.Enchantments append value {id:"minecraft:punch",lvl:1s}
execute if data storage manic:storage root.temp.item.tag.manic{enchantment:"minecraft:sharpness"} if data entity @s item.tag.manic.item.tag.Enchantments[{id:"minecraft:sharpness"}] store result entity @s item.tag.manic.item.tag.Enchantments[{id:"minecraft:sharpness"}].lvl short -1 run data get entity @s item.tag.manic.item.tag.Enchantments[{id:"minecraft:sharpness"}].lvl -1.0000000001
execute if data storage manic:storage root.temp.item.tag.manic{enchantment:"minecraft:sharpness"} unless data entity @s item.tag.manic.item.tag.Enchantments[{id:"minecraft:sharpness"}] run data modify entity @s item.tag.manic.item.tag.Enchantments append value {id:"minecraft:sharpness",lvl:1s}
execute if data storage manic:storage root.temp.item.tag.manic{enchantment:"minecraft:smite"} if data entity @s item.tag.manic.item.tag.Enchantments[{id:"minecraft:smite"}] store result entity @s item.tag.manic.item.tag.Enchantments[{id:"minecraft:smite"}].lvl short -1 run data get entity @s item.tag.manic.item.tag.Enchantments[{id:"minecraft:smite"}].lvl -1.0000000001
execute if data storage manic:storage root.temp.item.tag.manic{enchantment:"minecraft:smite"} unless data entity @s item.tag.manic.item.tag.Enchantments[{id:"minecraft:smite"}] run data modify entity @s item.tag.manic.item.tag.Enchantments append value {id:"minecraft:smite",lvl:1s}
execute if data storage manic:storage root.temp.item.tag.manic{enchantment:"minecraft:sweeping"} if data entity @s item.tag.manic.item.tag.Enchantments[{id:"minecraft:sweeping"}] store result entity @s item.tag.manic.item.tag.Enchantments[{id:"minecraft:sweeping"}].lvl short -1 run data get entity @s item.tag.manic.item.tag.Enchantments[{id:"minecraft:sweeping"}].lvl -1.0000000001
execute if data storage manic:storage root.temp.item.tag.manic{enchantment:"minecraft:sweeping"} unless data entity @s item.tag.manic.item.tag.Enchantments[{id:"minecraft:sweeping"}] run data modify entity @s item.tag.manic.item.tag.Enchantments append value {id:"minecraft:sweeping",lvl:1s}
execute if data storage manic:storage root.temp.item.tag.manic{enchantment:"minecraft:unbreaking"} if data entity @s item.tag.manic.item.tag.Enchantments[{id:"minecraft:unbreaking"}] store result entity @s item.tag.manic.item.tag.Enchantments[{id:"minecraft:unbreaking"}].lvl short -1 run data get entity @s item.tag.manic.item.tag.Enchantments[{id:"minecraft:unbreaking"}].lvl -1.0000000001
execute if data storage manic:storage root.temp.item.tag.manic{enchantment:"minecraft:unbreaking"} unless data entity @s item.tag.manic.item.tag.Enchantments[{id:"minecraft:unbreaking"}] run data modify entity @s item.tag.manic.item.tag.Enchantments append value {id:"minecraft:unbreaking",lvl:1s}

# Finish
data modify storage manic:storage root.temp.item set from entity @s item.tag.manic.item
execute positioned ~ ~1 ~ as @e[type=item_display,tag=manic.plinth_item,sort=nearest,limit=1,distance=..0.05] run kill @s
data merge entity @s {item:{tag:{manic:{item:{}}}}}
tag @s remove manic.grimstone_plinth.has_item
tag @s remove manic.grimstone_plinth.has_elderskin

data modify entity @s item.tag.CustomModelData set value 8360006
data modify entity @s[tag=manic.grimstone_plinth.wrapped] item.tag.CustomModelData set value 8360008
data modify entity @s[tag=manic.grimstone_plinth.full] item.tag.CustomModelData set value 8360007
data modify entity @s[tag=manic.grimstone_plinth.full,tag=manic.grimstone_plinth.wrapped] item.tag.CustomModelData set value 8360009

execute if data storage manic:storage root.temp.item.tag.manic{upgrade_type:"sword"} run scoreboard players set #tool manic.dummy 1
execute if data storage manic:storage root.temp.item.tag.manic{upgrade_type:"pickaxe"} run scoreboard players set #tool manic.dummy 2
execute if data storage manic:storage root.temp.item.tag.manic{upgrade_type:"axe"} run scoreboard players set #tool manic.dummy 3
execute if data storage manic:storage root.temp.item.tag.manic{upgrade_type:"shovel"} run scoreboard players set #tool manic.dummy 4
execute if data storage manic:storage root.temp.item.tag.manic{upgrade_type:"hoe"} run scoreboard players set #tool manic.dummy 5
execute if data storage manic:storage root.temp.item.tag.manic{upgrade_type:"bow"} run scoreboard players set #tool manic.dummy 6
loot spawn ~ ~1 ~ loot manic:technical/copy_nbt/apply_sigil

data modify storage manic:storage root.temp.result set value "reduce_count"
data modify storage manic:storage root.temp.advancement set value "sigil"
playsound manic:block.grimstone_plinth.transform block @a
execute positioned ~ ~1 ~ run function manic:block/grimstone_plinth/visuals/main
